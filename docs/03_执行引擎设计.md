# 执行引擎设计

## 概述
基于算子的执行引擎，将AST转换为可执行的查询计划。采用迭代器模式，支持流式处理。

## 架构
```
AST → PlanGenerator → Operator Tree → Executor → Results
```

## 核心组件
```
include/
├── execution_plan.h      # 算子定义
├── plan_generator.h      # 计划生成器
└── executor.h           # 执行器

src/execution/
├── plan_generator.cpp   # 计划生成器实现
└── executor.cpp        # 执行器实现
```

## 算子系统

### 算子基类
```cpp
class Operator {
public:
    enum OperatorType {
        CREATE_TABLE_OP, INSERT_OP, SELECT_OP, DELETE_OP,
        SEQ_SCAN_OP, FILTER_OP, PROJECT_OP
    };
    
    // 核心接口：获取下一批结果
    virtual std::unique_ptr<Tuple> next() = 0;
    virtual ~Operator() = default;
};
```

### 数据类型
```cpp
using Value = std::variant<int, std::string, bool>;
using Tuple = std::vector<Value>;
```

### 主要算子

#### CreateTableOperator
- **功能**: 创建表
- **实现**: 调用TableManager创建表结构

#### InsertOperator  
- **功能**: 插入记录
- **实现**: 调用TableManager插入数据

#### SeqScanOperator
- **功能**: 顺序扫描表
- **实现**: 从TableManager获取所有记录

#### FilterOperator
- **功能**: 条件过滤
- **实现**: 使用TableManager的SelectColumnsWithCondition方法

#### ProjectOperator
- **功能**: 列投影
- **实现**: 选择指定列返回

## 执行计划生成器

### PlanGenerator
- **功能**: 将AST转换为算子树
- **输入**: AST节点
- **输出**: 算子执行计划

### 使用方式
```cpp
PlanGenerator generator(table_manager);
std::unique_ptr<Operator> plan = generator.visit(ast_node);
```

## 执行器

### Executor
- **功能**: 执行算子计划
- **实现**: 调用根算子的next()方法获取结果

### 使用方式
```cpp
Executor executor(std::move(plan));
std::vector<Tuple> results = executor.execute();
```