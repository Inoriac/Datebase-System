# 目录管理设计

## 概述
目录管理系统负责表的元数据管理，包括表结构定义、记录操作和模式持久化。

## 架构
```
TableManager (表管理器)
├── TableSchemaManager (表结构管理器)
├── IndexManager (索引管理器)
└── BufferPoolManager (缓冲池管理器)
```

## 核心组件

### TableManager
- **功能**: 表生命周期管理
- **职责**: 创建表、插入记录、查询记录、删除记录
- **接口**: 统一的表操作接口

### TableSchemaManager
- **功能**: 表结构持久化
- **职责**: 保存/加载表结构到系统目录
- **存储**: 使用`__system_catalog__`表存储元数据

## 数据类型
```cpp
// 值类型
using Value = std::variant<int, std::string, bool>;

// 记录结构
struct Record {
    std::vector<Value> values_;
    void AddValue(const Value& value);
};

// 表结构
struct TableSchema {
    std::string table_name_;
    std::vector<Column> columns_;
    int primary_key_index_;
};
```

## 使用方式
```cpp
// 创建表
TableSchema schema("users");
schema.AddColumn(Column("id", DataType::Int, 4, true));
schema.AddColumn(Column("name", DataType::Varchar, 50, true));
table_manager.CreateTable(schema);

// 插入记录
Record record;
record.AddValue(1);
record.AddValue("Alice");
table_manager.InsertRecord("users", record);

// 查询记录
std::vector<Record> records = table_manager.SelectRecords("users");
std::vector<Record> filtered = table_manager.SelectColumnsWithCondition(
    "users", {"name", "age"}, "age > 25");
```

## 持久化机制
- **表结构**: 存储在`__system_catalog__`系统表中
- **数据记录**: 通过BufferPoolManager写入磁盘
- **索引数据**: B+树索引持久化到独立文件

## 文件结构
```
include/catalog/
├── table_manager.h           # 表管理器接口
├── table_schema_manager.h    # 表结构管理器接口
├── types.h                   # 数据类型定义
└── record_serializer.h       # 记录序列化

src/catalog/
├── table_manager.cpp         # 表管理器实现
├── table_schema_manager.cpp  # 表结构管理器实现
└── record_serializer.cpp     # 记录序列化实现
```
